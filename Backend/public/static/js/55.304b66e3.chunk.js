(self.webpackChunkmodernize=self.webpackChunkmodernize||[]).push([[55],{6768:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});n(2791);var s=n(4270),i=n(184);const o=e=>{let{title:t,description:n,children:o}=e;return(0,i.jsxs)("div",{children:[(0,i.jsxs)(s.q,{children:[(0,i.jsx)("title",{children:t}),(0,i.jsx)("meta",{name:"description",content:n})]}),o]})}},55:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var s=n(7621),i=(n(2791),n(184));const o=e=>{let{children:t,className:n}=e;return(0,i.jsx)(s.Z,{sx:{p:0,position:"relative"},className:n,elevation:9,variant:void 0,children:t})}},3980:(e,t,n)=>{"use strict";n.d(t,{Qp:()=>r,ev:()=>a});var s=n(6996);const i="/api/exams",o=s.g.injectEndpoints({endpoints:e=>({getCheatingLogs:e.query({query:e=>({url:"".concat(i,"/cheatingLogs/").concat(e),method:"GET"})}),saveCheatingLog:e.mutation({query:e=>({url:"".concat(i,"/cheatingLogs"),method:"POST",body:e})})})}),{useGetCheatingLogsQuery:r,useSaveCheatingLogMutation:a}=o},1105:(e,t,n)=>{"use strict";n.d(t,{C:()=>c,DB:()=>d,Xf:()=>r,uZ:()=>a});var s=n(6996);const i="/api/exams",o=s.g.injectEndpoints({endpoints:e=>({getExams:e.query({query:()=>({url:"".concat(i,"/exam"),method:"GET"})}),createExam:e.mutation({query:e=>({url:"".concat(i,"/exam"),method:"POST",body:e})}),getQuestions:e.query({query:e=>({url:"".concat(i,"/exam/questions/").concat(e),method:"GET"})}),createQuestion:e.mutation({query:e=>({url:"".concat(i,"/exam/questions"),method:"POST",body:e})})})}),{useGetExamsQuery:r,useCreateExamMutation:a,useGetQuestionsQuery:d,useCreateQuestionMutation:c}=o},5282:(e,t,n)=>{"use strict";n.d(t,{CP:()=>a,Mt:()=>d,vL:()=>r});var s=n(6996);const i="/api/results",o=s.g.injectEndpoints({endpoints:e=>({getResultsByExam:e.query({query:e=>({url:"".concat(i,"/exam/").concat(e),method:"GET"})}),getStudentResults:e.query({query:e=>({url:"".concat(i,"/student/").concat(e),method:"GET"}),providesTags:[{type:"StudentResults"}]}),submitStudentResult:e.mutation({query:e=>{let{studentId:t,examId:n,answers:s}=e;return{url:"".concat(i,"/student"),method:"POST",body:{studentId:t,examId:n,answers:s}}}}),updateResultStatus:e.mutation({query:e=>{let{resultId:t,status:n,updatedBy:s}=e;return{url:"".concat(i,"/").concat(t),method:"PUT",body:{status:n,updatedBy:s}}},invalidatesTags:[{type:"StudentResults"}]})})}),{useGetStudentResultsQuery:r,useUpdateResultStatusMutation:a,useSubmitStudentResultMutation:d,useGetResultsByExamQuery:c}=o},9308:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>_});var s=n(2791),i=n(7689),o=n(4554),r=n(3239),a=n(890),d=n(1889),c=n(6768),u=n(55),l=n(9174),h=n(5523),m=n(8096),x=n(6151),p=n(7621),g=n(9504),v=n(3767),f=n(1105),j=n(184);function y(e){let{questions:t,answers:n,onAnswer:i,currentQuestion:r,handleNextQuestion:d,handleTestSubmission:c}=e;const[u,f]=(0,s.useState)(null);(0,s.useEffect)((()=>{if(n&&t&&t[r]){const e=n.find((e=>e.questionId===t[r]._id));f(e?e.selectedOptionIndex:null)}}),[r,n,t]);return t&&0!==t.length?(0,j.jsx)(p.Z,{children:(0,j.jsxs)(g.Z,{children:[(0,j.jsxs)(a.Z,{variant:"h6",mb:3,children:["Question ",r+1,":"]}),(0,j.jsx)(a.Z,{variant:"body1",mb:3,children:t[r].question}),(0,j.jsx)(o.Z,{mb:3,children:(0,j.jsx)(m.Z,{component:"fieldset",children:t[r].options.map(((e,n)=>(0,j.jsx)(h.Z,{control:(0,j.jsx)(l.Z,{checked:u===n,onChange:()=>(e=>{var n;f(e),"function"===typeof i&&null!==(n=t[r])&&void 0!==n&&n._id&&i(t[r]._id,e)})(n)}),label:e.optionText},e._id)))})}),(0,j.jsx)(v.Z,{direction:"row",spacing:2,justifyContent:"space-between",children:r===t.length-1?(0,j.jsx)(x.Z,{variant:"contained",color:"primary",onClick:c,style:{marginLeft:"auto"},children:"Finish"}):(0,j.jsx)(x.Z,{variant:"contained",color:"primary",onClick:d,disabled:null===u,style:{marginLeft:"auto"},children:"Next Question"})})]})}):(0,j.jsx)(a.Z,{variant:"body1",children:"No questions available."})}var b=n(3044);n(2702);const Z=e=>{let{questionLength:t,submitTest:n,examDurationInSeconds:i,currentQuestion:r,onJumpToQuestion:c,answers:u,questions:l,answeredAndMoved:h,submitted:m}=e;const p=t,g=Array.from({length:p},((e,t)=>t+1)),f=[];for(let s=0;s<g.length;s+=5)f.push(g.slice(s,s+5));const[y,Z]=(0,s.useState)(i);return(0,s.useEffect)((()=>{Z(i)}),[i]),(0,s.useEffect)((()=>{if(m)return;if(y<=0)return void n();const e=setInterval((()=>{Z((e=>e-1))}),1e3);return()=>{clearInterval(e)}}),[y,n,m]),(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(o.Z,{position:"sticky",top:"0",zIndex:1,bgcolor:"white",paddingY:"10px",width:"100%",px:3,children:(0,j.jsxs)(v.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",children:[(0,j.jsxs)(a.Z,{variant:"h6",children:["Questions: ",r+1,"/",t]}),(0,j.jsxs)(a.Z,{variant:"h6",children:["Time Left: ",Math.floor(y/60),":",y%60]}),(0,j.jsx)(x.Z,{variant:"contained",onClick:()=>n(),color:"error",disabled:m,children:m?"Test Submitted":"Finish Test"})]})}),(0,j.jsx)(o.Z,{p:3,mt:5,maxHeight:"270px",children:(0,j.jsx)(d.ZP,{container:!0,spacing:1,children:f.map(((e,t)=>(0,j.jsx)(d.ZP,{item:!0,xs:12,children:(0,j.jsx)(v.Z,{direction:"row",alignItems:"center",justifyContent:"start",children:e.map((e=>{const t=l&&l[e-1],n=h&&t&&h.includes(t._id);return(0,j.jsx)(b.Z,{variant:"rounded",style:{width:"40px",height:"40px",fontSize:"20px",cursor:"pointer",margin:"3px",background:n?"#90ee90":"#ccc",color:"#fff"},onClick:()=>(e=>{"function"===typeof c&&c(e-1)})(e),children:e},e)}))})},t)))})})]})};var w=n(3063),C=n(1989),I=(n(6089),n(8377)),S=n(97),q=n.n(S),T=n(2062),E=n.n(T);function Q(e){let{cheatingLog:t,updateCheatingLog:n}=e;const i=(0,s.useRef)(null),[r,a]=(0,s.useState)(!1),[d,c]=(0,s.useState)(null),u=(0,s.useRef)(null),l=(0,s.useRef)(null),h=(null===t||void 0===t?void 0:t.studentId)||(null===t||void 0===t?void 0:t._id)||null,m=(null===t||void 0===t?void 0:t.examId)||null,x=async e=>{if("undefined"!==typeof u.current&&null!==u.current&&4===u.current.video.readyState){const t=u.current.video,s=u.current.video.videoWidth,i=u.current.video.videoHeight;u.current.video.width=s,u.current.video.height=i,l.current.width=s,l.current.height=i;const o=await e.detect(t);l.current.getContext("2d");let r=0;o.length<1&&(n((e=>(0,w.Z)((0,w.Z)({},e),{},{noFaceCount:e.noFaceCount+1}))),E()("Face Not Visible","Action has been Recorded","error")),o.forEach((e=>{"cell phone"===e.class&&(n((e=>(0,w.Z)((0,w.Z)({},e),{},{cellPhoneCount:e.cellPhoneCount+1}))),E()("Cell Phone Detected","Action has been Recorded","error")),"book"===e.class&&(n((e=>(0,w.Z)((0,w.Z)({},e),{},{prohibitedObjectCount:e.prohibitedObjectCount+1}))),E()("Prohibited Object Detected","Action has been Recorded","error")),"person"===!e.class&&E()("Face Not Visible","Action has been Recorded","error"),"person"===e.class&&(r++,r>1&&(n((e=>(0,w.Z)((0,w.Z)({},e),{},{multipleFaceCount:e.multipleFaceCount+1}))),E()("Multiple Faces Detected","Action has been Recorded","error"),r=0))}))}};return(0,s.useEffect)((()=>{(async()=>{const e=await I.load();console.log("Ai models loaded."),setInterval((()=>{x(e)}),1500)})();let e=null,t=null,n=[];const s=setInterval((()=>{u.current&&u.current.stream&&!r&&((async()=>{u.current&&u.current.stream&&(e=u.current.stream,t=new window.MediaRecorder(e,{mimeType:"video/webm"}),i.current=t,t.ondataavailable=e=>{e.data&&e.data.size>0&&n.push(e.data)},t.onstop=async()=>{const e=new Blob(n,{type:"video/webm"});if(c(e),e&&h&&m){const n=new FormData;n.append("video",e,"exam_".concat(m,"_student_").concat(h,".webm")),n.append("studentId",h),n.append("examId",m);try{await C.Z.post("/api/videos",n,{headers:{"Content-Type":"multipart/form-data"}}),console.log("Video uploaded successfully")}catch(t){console.error("Video upload failed:",t)}}},t.start(),a(!0))})(),clearInterval(s))}),500);return()=>{i.current&&r&&(i.current.stop(),a(!1))}}),[h,m,r]),(0,j.jsx)(o.Z,{children:(0,j.jsxs)(p.Z,{variant:"outlined",children:[(0,j.jsx)(q(),{ref:u,muted:!0,style:{left:0,right:0,textAlign:"center",zindex:9,width:"100%",height:"100%"}}),(0,j.jsx)("canvas",{ref:l,style:{position:"absolute",marginLeft:"auto",marginRight:"auto",left:0,right:0,textAlign:"center",zindex:8,width:240,height:240}})]})})}var P=n(3980),R=n(5048),A=n(5282),L=n(6996);const k=L.g.injectEndpoints({endpoints:e=>({checkExamAttempt:e.query({query:e=>{let{examId:t,studentId:n}=e;return{url:"".concat("/api/attempts","/check/").concat(t,"/").concat(n),method:"GET"}}})})}),{useCheckExamAttemptQuery:F}=k;var M=n(5206);const _=()=>{const[e,t]=(0,s.useState)(0),[n]=(0,A.Mt)(),[l,h]=(0,s.useState)([]),[m,x]=(0,s.useState)([]),{examId:p,testId:g}=(0,i.UO)(),{userInfo:v}=(0,R.v9)((e=>e.auth)),b=null===v||void 0===v?void 0:v._id,[w,C]=(0,s.useState)([]),[I,S]=(0,s.useState)(0),{data:q}=(0,f.Xf)(),[T,E]=(0,s.useState)([]),{data:L,isLoading:k}=(0,f.DB)(p),[_,D]=(0,s.useState)(0),[G,O]=(0,s.useState)(!1),N=async()=>{try{console.log("Submitting cheating log:",H);const e=await B(H);console.log("Cheating log mutation result:",e),await n({examId:p,studentId:b,answers:l}),O(!0),M.Am.success("Test submitted!"),z("/dashboard")}catch(e){console.error("Error submitting test or cheating log:",e),M.Am.error("Error submitting test or cheating log.")}},z=(0,i.s0)(),[B]=(0,P.ev)(),[H,V]=(0,s.useState)({noFaceCount:0,multipleFaceCount:0,cellPhoneCount:0,prohibitedObjectCount:0,examId:p,username:(null===v||void 0===v?void 0:v.name)||(null===v||void 0===v?void 0:v.username)||"",email:(null===v||void 0===v?void 0:v.email)||""}),{data:U,isLoading:Y}=F({examId:p,studentId:b});return(0,s.useEffect)((()=>{if(q){const e=q.filter((e=>e.examId===p));C(e),S(60*e[0].duration)}}),[q]),(0,s.useEffect)((()=>{L&&E(L)}),[L]),"teacher"===(null===v||void 0===v?void 0:v.role)?(0,j.jsx)(i.Fg,{to:"/dashboard",replace:!0}):Y?(0,j.jsxs)(o.Z,{textAlign:"center",mt:8,children:[(0,j.jsx)(r.Z,{}),(0,j.jsx)(a.Z,{children:"Checking exam attempt..."})]}):null!==U&&void 0!==U&&U.attempted?(0,j.jsx)(o.Z,{textAlign:"center",mt:8,children:(0,j.jsx)(a.Z,{variant:"h5",color:"error",children:"You have already attempted this exam."})}):(0,j.jsx)(c.Z,{title:"TestPage",description:"This is TestPage",children:(0,j.jsx)(o.Z,{pt:"3rem",children:(0,j.jsxs)(d.ZP,{container:!0,spacing:3,children:[(0,j.jsx)(d.ZP,{item:!0,xs:12,md:7,lg:7,children:(0,j.jsx)(u.Z,{children:(0,j.jsx)(o.Z,{width:"100%",minHeight:"400px",boxShadow:3,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",children:k?(0,j.jsx)(r.Z,{}):(0,j.jsx)(y,{questions:L,answers:l,onAnswer:(e,t)=>{h((n=>[...n.filter((t=>t.questionId!==e)),{questionId:e,selectedOptionIndex:t}]))},currentQuestion:e,handleNextQuestion:()=>{var n,s;(t((e=>Math.min(e+1,T.length-1))),m.includes(null===(n=T[e])||void 0===n?void 0:n._id))||x([...m,null===(s=T[e])||void 0===s?void 0:s._id])},handleTestSubmission:N})})})}),(0,j.jsx)(d.ZP,{item:!0,xs:12,md:5,lg:5,children:(0,j.jsxs)(d.ZP,{container:!0,spacing:3,children:[(0,j.jsx)(d.ZP,{item:!0,xs:12,children:(0,j.jsx)(u.Z,{children:(0,j.jsx)(o.Z,{maxHeight:"300px",sx:{display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"center",overflowY:"auto",height:"100%"},children:(0,j.jsx)(Z,{questionLength:T.length,submitTest:N,examDurationInSeconds:I,currentQuestion:e,onJumpToQuestion:t,answers:l,questions:T,answeredAndMoved:m,submitted:G})})})}),(0,j.jsx)(d.ZP,{item:!0,xs:12,children:(0,j.jsx)(u.Z,{children:(0,j.jsx)(o.Z,{width:"300px",maxHeight:"180px",boxShadow:3,display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"center",children:(0,j.jsx)(Q,{cheatingLog:H,updateCheatingLog:V})})})})]})})]})})})}},5410:()=>{},8628:()=>{},1601:()=>{},7792:()=>{},4977:()=>{},5042:()=>{}}]);
//# sourceMappingURL=55.304b66e3.chunk.js.map